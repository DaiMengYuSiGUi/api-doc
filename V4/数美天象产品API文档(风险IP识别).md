# 数美-天象产品API文档-风险IP识别部分

---

***版权所有 翻版必究***

---

* [风险ip识别](#riskDiscernInterface)
  + [具体接口](#requestInterface)
    - [请求URL](#requestUrl)
    - [字符编码格式](#requestEncode)
    - [请求方法](#requestMethod)
    - [建议超时时长](#requestTimeout)
    - [请求参数](#requestParameters)
  + [返回结果](#response)
  + [示例](#example)
    - [请求示例](#requestExample)
    - [返回示例](#responseExample)

# <span id = "riskDiscernInterface">风险IP识别</span>

## <span id = "requestInterface">具体接口定义</span>

### <span id = "requestUrl">请求URL：</span>

| 集群   | URL                                                       | 支持产品列表 |
| -------- | ----------------------------------------------------------- | -------------- |
| 北京集群   | `http://api-tianxiang-bj.fengkongcloud.com/tianxiang/v4`  | 天象风险识别 |
| 新加坡集群 | `http://api-tianxiang-xjp.fengkongcloud.com/tianxiang/v4` | 天象风险识别 |
|法兰克福集群|http://api-tianxiang-eur.fengkongcloud.com/tianxiang/v4|天象风险识别 |
|弗吉尼亚集群|http://api-tianxiang-fjny.fengkongcloud.com/tianxiang/v4|天象风险识别 |
### <span id = "requestMethod">请求方法：</span>

`POST`

### <span id = "requestEncode">字符编码：</span>

`UTF-8`

### <span id = "requestTimeout">建议超时时间：</span>

1s

### <span id = "requestParameters">请求参数：</span>

放在HTTP Body中，采用Json格式，具体参数如下：

| **请求参数名** | **类型**    | **参数说明** | **是否必传** | **规范** |
| ---------------- | ------------- | ------------------------------------------------------------------------------------------------------ | -------------- | ------------------------------------------------- |
| accessKey      | string      | 接口认证密钥<br/>用于权限认证，开通账号服务时由数美提供或使用开通邮箱登录数美后台右上角相关文档处查看 | 必传参数     | 数美分配                                        |
| data           | json_object | 请求的数据内容                                                                                       | 必传参数     | 请求的数据内容，最长10MB，[详见data参数](#data) |

<span id = "data">其中，data的内容如下：</span>


| **请求参数名** | **类型** | **参数说明**                                                                                                                                    | **是否必传** | **规范**                                                 |
| ---------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | -------------- | ---------------------------------------------------------- |
| IP             | string   | 待检查的IP  | 不能为空 | 该信息为客户要检查的IP，当前只支持IPv4类型传入                                   |

## <span id = "response">返回结果</span>

放在HTTP Body中，采用Json格式，具体参数如下：


| **参数名称**       | **参数类型** | **参数说明**   | **是否必返** | **规范**                                                                                                                                                                                                  |
| -------------------- | -------------- | ---------------- | -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| code               | int          | 返回码         | 是           | `1100`：成功<br/>`1901`：QPS超限<br/>`1902`：参数不合法<br/>`1903`：服务失败<br/>`9101`：无权限操作<br/>除message和requestId之外的字段，只有当code为1100时才会存在 |
| message            | string       | 返回码描述     | 是           | 和code对应：`成功 QPS超限 参数不合法 服务失败 余额不足 无权限操作`                                                                                                                                          |
| requestId          | string       | 请求标识       | 是           | 请求唯一标识，用于排查问题和后续效果优化，强烈建议保存                                                                                                                                                      |
| profileExist       | int          | 设备画像存在   | 是           | `1`：画像库中存在该设备信息<br/>`0`：画像库中不存在该设备信息                                                                                                                                                    |
| ipLabels           | json_object  | ip标签信息     | 否           | 见下面详情内容，仅在ip传入且服务开通时返回                                                                                                                                                                  |

其中


**1）ipLabels的详情内容**


| ***返回结果参数名*** | ***参数类型*** | ***参数说明***   | ***规范*** |
| ---------------------- | ---------------- | ------------------ | ------------ |
| risk_ip              | json_object    | 业务风险IP |            |
| b_secdial            | json_object    | 秒拨IP |        
| b_idc                | json_object    | 机房IP |
| b_proxy              | json_object    | 代理IP |
| ip_continent         | json_object    | IP归属洲信息     |            |
| ip_country           | json_object    | ip归属国信息     |            |
| ip_province          | json_object    | ip归属省信息     |            |
| ip_city              | json_object    | ip归属城市信息   |            |
| ip_owner             | json_object    | ip归属运营商信息 |            |
| ip_longitude         | json_object    | ip归属地维度     |            |
| ip_latitude          | json_object    | ip归属地经度     |            |
| b_cmwap              | json_object    | 移动梦网         |            |
| b_cgn                | json_object    | 运营商保留NAT    |            |

其中risk_ip


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范***                |
| ---------------------- | ---------------- | ---------------- | --------------------------- |
| risk_ip              | int            | 业务风险IP       | `0`：非业务风险IP `1`：业务风险IP |
| risk_ip_last_ts      | int            | 业务风险IP命中时间 |                           |

其中b_secdial


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范***                |
| -------------------- | -------------- | -------------- | ------------------------- |
| b_secdial            | int            | 秒拨IP         | `0`：非秒拨IP `1`：秒拨IP |
| b_secdial_last_ts    | int            | 秒拨IP验证时间 |                           |

其中b_idc


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范***                |
| -------------------- | -------------- | -------------- | ------------------------- |
| b_idc                | int            | 机房IP         | `0`：非机房IP `1`：机房IP |
| b_idc_last_ts        | int            | 机房IP验证时间 |                           |

其中b_proxy


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范***                |
| -------------------- | -------------- | -------------- | ------------------------- |
| b_proxy              | int            | 代理IP         | `0`：非代理IP `1`：代理IP |
| b_proxy_last_ts      | int            | 代理IP验证时间 |                           |



其中 ip_continent


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范*** |
| ---------------------- | ---------------- | ---------------- | ------------ |
| ip_continent         | string         | 归属洲         |            |

其中 ip_country


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范*** |
| ---------------------- | ---------------- | ---------------- | ------------ |
| ip_country           | string         | 归属国家       |            |

其中 ip_province


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范*** |
| ---------------------- | ---------------- | ---------------- | ------------ |
| ip_province          | string         | 归属省份       |            |

其中 ip_city


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范*** |
| ---------------------- | ---------------- | ---------------- | ------------ |
| ip_city              | string         | 归属城市       |            |

其中 ip_owner


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范*** |
| ---------------------- | ---------------- | ---------------- | ------------ |
| ip_owner             | string         | 归属运营商     |            |

其中 ip_longitude


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范*** |
| ---------------------- | ---------------- | ---------------- | ------------ |
| ip_longitude         | float          | 归属地纬度     |            |

其中 ip_latitude


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范*** |
| ---------------------- | ---------------- | ---------------- | ------------ |
| ip_latitude          | float          | 归属地经度     |            |

其中 b_cmwap


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范***                      |
| ---------------------- | ---------------- | ---------------- | --------------------------------- |
| b_cmwap              | int            | 移动梦网       | `0`：非移动梦网 `1`：是移动梦网 |

其中 b_cgn


| ***返回结果参数名*** | ***参数类型*** | ***参数说明*** | ***规范***                                 |
| ---------------------- | ---------------- | ---------------- | -------------------------------------------- |
| b_cgn                | int            | 运营商保留NAT  | `0`：非运营商保留NAT  `1`：是运营商保留NAT |


## <span id = "example">示例：</span>

### <span id = "requestExample">请求示例：</span>

```json
{
  "accessKey": "xxxxxxxxxxxxxxxxxxxxxxxxx",
  "data": {
    "tokenId": "ceshizhanghao",
    "deviceId": "ceshideviceId",
    "phone": "ceshiphone",
    "ip":"116.237.64.174"
  }
}
```

### <span id = "syncResponseExample">同步返回示例：</span>

```json
{
  "code": 1100,
  "message": "成功",
  "profileExist": 1,
  "requestId": "7a5445716f0581c2ab1d381a6af4d1b8",
  "ipLabels": {
    "risk_ip": {
      "risk_ip": 1,
      "risk_ip_last_ts": 1587711321232
    },
    "b_secdial": {
      "b_secdial": 1,
      "b_secdial_last_ts": 1587711321232
    },
    "b_idc": {
      "b_idc": 1,
      "b_idc_last_ts": 1587711321232
    },
    "b_proxy": {
      "b_proxy": 1,
      "b_proxy_last_ts": 1587711321232
    },
    "ip_continent": {
      "ip_continent": "亚洲"
    },
    "ip_country": {
      "ip_country": "中国"
    },
    "ip_province": {
      "ip_province": "香港"
    },
    "ip_city": {
      "ip_province": "浦东区"
    },
    "ip_owner": {
      "ip_owner": "移动"
    },
    "ip_longitude": {
      "ip_longitude": 39.90279
    },
    "ip_latitude": {
      "ip_latitude": 39.90279
    },
    "b_cmwap": {
      "b_cmwap": "xxx"
    },
    "b_cgn": {
      "b_cgn": "xxx"
    }
  }
}
```